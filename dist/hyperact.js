!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).Hyperact={})}(this,(function(t){"use strict";const n="undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame)||function(t){setTimeout(t,0)};let e=Date.getTime;function i(t){this.time,this.disableAnimation=!1,this.duration,this.easing,t&&Object.keys(t).forEach(function(n){this[n]=t[n]}.bind(this))}function r(){this.targets=[],this.getPresentations=[],this.getAnimationCounts=[],this.transactions=[],this.ticking=!1,this.animationFrame,this.displayLayers=[],this.displayFunctions=[],this.cleanupFunctions=[],this.invalidateFunctions=[],this.force=[],this.changers=[]}function o(t){return t&&"[object Function]"==={}.toString.call(t)}function s(){}function a(){}function c(t,n,e){this.subtype=t,o(t)&&(this.subtype=new t(e)),this.length=n}function u(t){o(t)?this.sort=t:t&&o(t.sort)&&(this.sort=t.sort),this.debug="HyperSet"}Date.now&&(e=Date.now),"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now&&(e=window.performance.now.bind(window.performance)),r.prototype={createTransaction:function(t,n){const r=new i(t),o=this.transactions.length;let s=e()/1e3;return o&&(s=this.transactions[o-1].representedObject.time),Object.defineProperty(r,"time",{get:function(){return s},enumerable:!0,configurable:!1}),this.transactions.push({representedObject:r,automaticallyCommit:n,flushers:[]}),n&&this.startTicking(),r},createTransactionWrapper:function(t,n){let r=this.targets.length;for(;r--;)this.invalidateFunctions[r]();const o=new i(t),s=this.transactions.length;let a=e()/1e3;s&&(a=this.transactions[s-1].representedObject.time),Object.defineProperty(o,"time",{get:function(){return a},enumerable:!0,configurable:!1});const c={representedObject:o,automaticallyCommit:n,flushers:[]};return this.transactions.push(c),n&&this.startTicking(),c},currentTransaction:function(){const t=this.transactions.length;return t?this.transactions[t-1].representedObject:this.createTransactionWrapper({},!0).representedObject},beginTransaction:function(t){return this.createTransactionWrapper(t,!1).representedObject},commitTransaction:function(){this.clearChangers(),this.clearFlushers(),this.transactions.pop()},clearFlushers:function(){const t=this.currentTransactionWrapper();t.flushers.forEach((t=>{t()})),t.flushers.length=0;let n=this.targets.length;for(;n--;)this.invalidateFunctions[n]()},flushTransaction:function(){this.clearChangers(),this.clearFlushers()},currentTransactionWrapper:function(){const t=this.transactions.length;return t?this.transactions[t-1]:this.createTransactionWrapper({},!0)},registerFlusher:function(t){this.currentTransactionWrapper().flushers.push(t)},registerChanger:function(t){this.changers.push(t),this.startTicking()},clearChangers:function(){const t=this.changers;let n=t.length;for(;n--;)t[n]();t.length=0},disableAnimation:function(t){!1!==t&&(t=!0);this.currentTransaction().disableAnimation=t,this.startTicking()},registerTarget:function(t,n,e,i,r,o,s,a=null){this.startTicking();const c=this.targets.indexOf(t);c<0?(this.targets.push(t),this.getPresentations.push(n),this.getAnimationCounts.push(e),this.displayLayers.push(a),this.displayFunctions.push(i),this.cleanupFunctions.push(o),this.invalidateFunctions.push(r),this.force.push(s)):this.force[c]=s},deregisterTarget:function(t){const n=this.targets.indexOf(t);n>-1&&(this.targets.splice(n,1),this.getPresentations.splice(n,1),this.getAnimationCounts.splice(n,1),this.displayLayers.splice(n,1),this.displayFunctions.splice(n,1),this.cleanupFunctions.splice(n,1),this.invalidateFunctions.splice(n,1),this.force.splice(n,1))},startTicking:function(){this.animationFrame||(this.animationFrame=n(this.ticker.bind(this)))},ticker:function(){this.clearChangers(),this.animationFrame=void 0;const t=this.targets;let n=t.length;for(;n--;){const e=t[n],i=this.displayFunctions[n],r=this.getAnimationCounts[n](),o=this.getPresentations[n];if(r){const t=o();(this.force[n]||this.displayLayers[n]!==t)&&(this.displayLayers[n]=t,i(t)),this.cleanupFunctions[n]()}else{this.invalidateFunctions[n]();i(o()),this.deregisterTarget(e)}this.force[n]=!1}const e=this.transactions.length;if(e){this.transactions[e-1].automaticallyCommit&&this.commitTransaction()}this.targets.length&&this.startTicking()}},s.prototype={constructor:s,zero:function(){return 0},add:function(t,n){return t+n},subtract:function(t,n){return t-n},interpolate:function(t,n,e){return t+(n-t)*e},input:function(t,n){return n},output:function(t,n){return n},toString:function(){return"HyperNumber"},toJSON:function(){return this.toString()}},a.prototype={constructor:a,zero:function(){return 1},add:function(t,n){return t*n},subtract:function(t,n){return 0===n?0:t/n},interpolate:function(t,n,e){return t+(n-t)*e},toString:function(){return"HyperScale"},toJSON:function(){return this.toString()}},c.prototype={constructor:c,zero:function(){const t=[];let n=this.length;for(;n--;)t.push(this.subtype.zero());return t},add:function(t,n){const e=[];for(let i=0;i<this.length;i++)e.push(this.subtype.add(t[i],n[i]));return e},subtract:function(t,n){const e=[];for(let i=0;i<this.length;i++)e.push(this.subtype.subtract(t[i],n[i]));return e},interpolate:function(t,n,e){const i=[];for(let r=0;r<this.length;r++)i.push(this.subtype.interpolate(t[r],n[r],e));return i},toString:function(){return"HyperArray"},toJSON:function(){return this.toString()}},u.prototype={constructor:u,zero:function(){return[]},add:function(t,n){if(!Array.isArray(t)&&!Array.isArray(n))return[];if(!Array.isArray(t))return n;if(!Array.isArray(n))return t;let e=[];const i=t.length,r=n.length;let s=0,a=0;if(o(this.sort))for(;s<i||a<r;)if(s===i)e.push(n[a]),a++;else if(a===r)e.push(t[s]),s++;else{const i=t[s],r=n[a],o=this.sort(i,r);if(0===o)e.push(i),s++,a++;else if(o<0)e.push(i),s++;else{if(!(o>0))throw new Error("HyperSet invalid sort function, add a:"+i+"; b:"+r+"; result:"+o+";");e.push(r),a++}}else for(e=t.slice(0),s=n.length;s--;)t.indexOf(n[s])<0&&e.push(n[s]);return e},subtract:function(t,n){if(!Array.isArray(t)&&!Array.isArray(n))return[];if(!Array.isArray(t))return n;if(!Array.isArray(n))return t;let e=[];const i=t.length,r=n.length;let s=0,a=0;if(o(this.sort))for(;(s<i||a<r)&&s!==i;)if(a===r)e.push(t[s]),s++;else{const i=t[s],r=n[a],o=this.sort(i,r);if(0===o)s++,a++;else if(o<0)e.push(i),s++;else{if(!(o>0))throw new Error("HyperSet invalid sort function, subtract a:"+i+"; b:"+r+"; result:"+o+";");a++}}else for(e=t.slice(0),s=n.length;s--;){const t=e.indexOf(n[s]);t>-1&&e.splice(t,1)}return e},interpolate:function(t,n,e){return e>=1?n:t},toString:function(){return"HyperSet"},toJSON:function(){return this.toString()}};class h{constructor(){}zero(){return g()}add(t,n){return y(t.x+n.x,t.y+n.y)}subtract(t,n){return y(t.x-n.x,t.y-n.y)}interpolate(t,n,e){return y(t.x+(n.x-t.x)*e,t.y+(n.y-t.y)*e)}toString(){return"HyperPoint"}toJSON(){return this.toString()}}class l{constructor(){}zero(){return w()}add(t,n){return b(t.width+n.width,t.height+n.height)}subtract(t,n){return b(t.width-n.width,t.height-n.height)}interpolate(t,n,e){return b(t.width+(n.width-t.width)*e,t.height+(n.height-t.height)*e)}toString(){return"HyperSize"}toJSON(){return this.toString()}}const f=Number.MAX_VALUE;function p(t,n,e,i){return{origin:y(t,n),size:b(e,i)}}function d(){return p(0,0,0,0)}function y(t,n){return{x:t,y:n}}function g(){return y(0,0)}function m(t,n){return t.x===n.x&&t.y===n.y}function b(t,n){return{width:t,height:n}}function w(){return b(0,0)}function A(t,n){return t.width===n.width&&t.height&&n.height}function O(t,n){return{location:t,length:n}}function v(){return O(f,0)}let T=0;const k=new s;function j(t){return t&&"[object Function]"==={}.toString.call(t)}function E(t){let n=[];Array.isArray(t)?n=t:t&&Array.isArray(t.chain)&&(n=t.chain),this.chain=n.map((function(t){return P(t)})),Object.defineProperty(this,"finished",{get:function(){return!this.chain.length||this.chain[this.chain.length-1].finished},enumerable:!1,configurable:!1}),t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){"chain"!==n&&"finished"!==n&&(this[n]=t[n])}.bind(this))}function x(t){let n=[];Array.isArray(t)?n=t:t&&t.group&&(n=t.group),this.group=n.map((function(t){return P(t)})),Object.defineProperty(this,"finished",{get:function(){let t=!0;return this.group.forEach((function(n){n.finished||(t=!1)})),t},enumerable:!1,configurable:!1}),t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){"group"!==n&&"finished"!==n&&(this[n]=t[n])}.bind(this))}function z(){this.property,this.type,this.duration,this.easing,this.speed,this.iterations,this.autoreverse,this.fillMode,this.index=0,this.delay=0,this.blend="relative",this.additive=!0,this.sort,this.finished=!1,this.startTime,this.progress,this.onend,this.remove=!0}function S(t){z.call(this);let n=[];t&&Array.isArray(t.keyframes)&&(n=t.keyframes),this.keyframes=n;const e=this.keyframes.length;t&&Object.keys(t).forEach(function(n){"keyframes"!==n&&(this[n]=t[n])}.bind(this)),Array.isArray(this.offsets)&&this.offsets.length===e?this.offsets.sort(((t,n)=>t-n)):this.offsets=e<2?[]:this.keyframes.map((function(t,n){return n/(e-1)})),this.progress=null}function F(t){z.call(this),this.from,this.to,this.delta,t&&Object.keys(t).forEach(function(n){this[n]=t[n]}.bind(this)),this.progress=null}function N(t){return t&&j(t.add)&&j(t.subtract)&&j(t.zero)&&j(t.interpolate)}function P(t){let n;if(!t&&0!==t)return t;if(t instanceof z||t instanceof S||t instanceof x||t instanceof E)n=t.copy.call(t);else if(Array.isArray(t))n=new x(t);else if((e=t)&&"object"==typeof e)n=N(t)?new F({type:t}):Array.isArray(t.keyframes)?new S(t):Array.isArray(t.group)?new x(t):Array.isArray(t.chain)?new E(t):new F(t);else if(function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(t))n=new F({duration:t});else{if(!0!==t)throw new Error("is this an animation:"+JSON.stringify(t));n=new F({})}var e;return n}function M(t){return t&&"[object Function]"==={}.toString.call(t)}function H(t,n,e,i,r){if(t instanceof F||t instanceof S){const o=t.property;if(n&&o&&M(n.typeOfProperty)){const e=n.typeOfProperty.call(n,o);e&&(t.type=e)}const s=I(o,n.keyInput,n),a=e[s],c=i[s]||function(t){if(!t)return null;return t.type?M(t.type)?new t.type:t.type:M(t)?new t:t}(a);t.property&&t.type&&r(t.property,t.type,!0),t instanceof F?((Array.isArray(t.from)||Array.isArray(t.to))&&!t.type&&M(t.sort)&&(t.type=new u(t.sort)),t.type||(t.type=c),(t.from||0===t.from)&&(t.from=C(t.from,s,n,i,t.type)),(t.to||0===t.to)&&(t.to=C(t.to,s,n,i,t.type)),(t.delta||0===t.delta)&&(t.delta=C(t.delta,s,n,i,t.type))):(t.type||(t.type=c),t.keyframes&&(t.keyframes=t.keyframes.map((e=>C(e,s,n,i,t.type)))),t.delta&&(t.delta=t.delta.map((e=>C(e,s,n,i,t.type)))))}else if(t instanceof x)t.group.forEach((function(t){H(t,n,e,i,r)}));else{if(!(t instanceof E))throw new Error("not an animation");t.chain.forEach((function(t){H(t,n,e,i,r)}))}}function I(t,n,e){return M(n)?n.call(e,t):t}function C(t,n,e,i,r){if(e&&M(e.input))return e.input.call(e,n,t);let o=t;const s=i[n];return r&&M(r.input)?o=r.input.call(r,n,t):s&&M(s.input)&&(o=s.input.call(s,n,t)),o}function R(t){if(t&&(t instanceof F||t instanceof S||t instanceof x||t instanceof E))return!0}E.prototype={constructor:E,copy:function(){return new this.constructor(this)},runAnimation:function(t,n,e){this.sortIndex=T++,null!==this.startTime&&void 0!==this.startTime||(this.startTime=e.time);let i=this.chain.length;const r=Object.assign({},e);let o=this.startTime;for(let e=0;e<i;e++){const i=this.chain[e];r.time=o,i.runAnimation.call(i,t,n,r),o=o===1/0||i.iterations===1/0?1/0:o+i.delay+i.duration*i.iterations}},composite:function(t,n){let e=!1,i=this.chain.length;for(let r=0;r<i;r++){const i=this.chain[r];e=i.composite.call(i,t,n)||e}return e},convert:function(t,n){j(t)&&this.chain.forEach((function(e){e.convert.call(e,t,n)}))}},E.prototype.description=function(t){const n=Object.assign({},this);return n.chain=this.chain.map((n=>n.description(t))),n},x.prototype={constructor:x,copy:function(){return new this.constructor(this)},runAnimation:function(t,n,e){this.sortIndex=T++,null!==this.startTime&&void 0!==this.startTime||(this.startTime=e.time),this.group.forEach((function(i){i.runAnimation.call(i,t,n,e)}))},composite:function(t,n){let e=!1;return this.group.forEach((function(i){e=i.composite.call(i,t,n)||e})),e},convert:function(t,n){j(t)&&this.group.forEach((function(e){e.convert.call(e,t,n)}))}},x.prototype.description=function(t){const n=Object.assign({},this);return n.group=this.group.map((n=>n.description(t))),n},z.prototype={copy:function(){return new this.constructor(this)},composite:function(t,n){if(null===this.startTime||void 0===this.startTime)throw new Error("Cannot composite an animation that has not been started.");if(this.startTime+this.delay>n&&"backwards"!==this.fillMode&&"both"!==this.fillMode)return!1;if(this.finished&&"forwards"!==this.fillMode&&"both"!==this.fillMode)return!1;const e=Math.max(0,n-(this.startTime+this.delay)),i=this.speed;let r=1,o=1;const s=this.duration,a=s*this.iterations;a&&(r=e*i/s,o=e*i/a),o>=1&&(r=1,this.finished=!0);let c,u=0;if(this.finished||(!0===this.autoreverse&&(u=Math.floor(r)%2),r%=1),u&&(r=1-r),j(this.easing))r=this.easing(r);else if("step-start"===this.easing)r=Math.ceil(r);else if("step-middle"===this.easing)r=Math.round(r);else if("step-end"===this.easing)r=Math.floor(r);else{const t=.5-Math.cos(r*Math.PI)/2;if(this.easing){const n=/(step-start|step-middle|step-end|steps)\((\d+)\)/.exec(this.easing);if(n){const e=n[1],i=n[2];i>0?"step-start"===e?r=Math.ceil(r*i)/i:"step-middle"===e?r=Math.round(r*i)/i:"step-end"!==e&&"steps"!==e||(r=Math.floor(r*i)/i):"linear"!==this.easing&&(r=t)}else"linear"!==this.easing&&(r=t)}else r=t}if(this instanceof S){const t=this.keyframes.length;if(!t)throw new Error("HyperAction composite need to be able to handle zero keyframes");if(1===t)throw new Error("HyperAction composite need to be able to handle one keyframe");let n=t-1;for(;n--&&!(r>=this.offsets[n]););const e=n;let i=e+1;const o=this.offsets[i]-this.offsets[e];if(0===o)throw new Error("can't divide by zero. check your keyframe offsets.");const s=(r-this.offsets[e])/o;c="absolute"===this.blend?this.type.interpolate(this.keyframes[e],this.keyframes[i],s):this.type.interpolate(this.delta[e],this.delta[i],s)}else c="absolute"===this.blend?this.type.interpolate(this.from,this.to,r):this.type.interpolate(this.delta,this.type.zero(this.to),r);const h=this.property;if(null!=h){let n=c,e=t[h];null==e&&(e=this.type.zero(this.to)),this.additive&&(n=this.type.add(e,c)),this.sort&&Array.isArray(n)&&n.sort(this.sort),t[h]=n}if(t[h]&&t[h].px&&t[h].px.length&&t[h].px.substring&&"NaN"===t[h].px.substring(t[h].px.length-3))throw new Error("hyperact NaN composite onto:"+JSON.stringify(t)+"; now:"+n+";");const l=r!==this.progress||this.finished;return this.progress=r,l}},S.prototype=Object.create(z.prototype),S.prototype.constructor=S,S.prototype.copy=function(){return new this.constructor(this)},S.prototype.runAnimation=function(t,n,e){if(this.type?j(this.type)&&(this.type=new this.type):this.type=k,!(j(this.type.zero)&&j(this.type.add)&&j(this.type.subtract)&&j(this.type.interpolate)))throw new Error("Animation runAnimation invalid type. Must implement zero, add, subtract, and interpolate.");if("absolute"!==this.blend&&this.keyframes.length){const t=this.keyframes.length-1,n=[];for(let e=0;e<t;e++)n[e]=this.type.subtract(this.keyframes[e],this.keyframes[t]);n[t]=this.type.zero(this.keyframes[t]),this.delta=n}null!==this.duration&&void 0!==this.duration||(this.duration=e.duration),null!==this.easing&&void 0!==this.easing||(this.easing=e.easing),null!==this.speed&&void 0!==this.speed||(this.speed=1),null!==this.iterations&&void 0!==this.iterations||(this.iterations=1),void 0!==this.startTime&&null!==this.startTime||(this.startTime=e.time),this.sortIndex=T++},S.prototype.convert=function(t,n){if(j(t)&&this.property){["keyframes","delta"].forEach(function(e){if(this[e]){const i=this[e].slice(0);this[e]=i.map((e=>t.call(n,this.property,e)))}}.bind(this))}},S.prototype.description=function(t){const n=Object.assign({},this);return this.convert.call(n,t.output,t),n},F.prototype=Object.create(z.prototype),F.prototype.constructor=F,F.prototype.runAnimation=function(t,n,e){if(this.type?j(this.type)&&(this.type=new this.type):this.type=k,!(j(this.type.zero)&&j(this.type.add)&&j(this.type.subtract)&&j(this.type.interpolate)))throw new Error("Animation runAnimation invalid type. Must implement zero, add, subtract, and interpolate.");this.from||(this.from=this.type.zero(this.to)),this.to||(this.to=this.type.zero(this.from)),"absolute"!==this.blend&&(this.delta=this.type.subtract(this.from,this.to)),null!==this.duration&&void 0!==this.duration||(this.duration=e.duration),null!==this.easing&&void 0!==this.easing||(this.easing=e.easing),null!==this.speed&&void 0!==this.speed||(this.speed=1),null!==this.iterations&&void 0!==this.iterations||(this.iterations=1),void 0!==this.startTime&&null!==this.startTime||(this.startTime=e.time),this.sortIndex=T++},F.prototype.convert=function(t,n){if(j(t)&&this.property){["from","to","delta"].forEach(function(e){const i=this[e];null!=i&&(this[e]=t.call(n,this.property,i))}.bind(this))}},F.prototype.description=function(t){const n=Object.assign({},this);return this.convert.call(n,t.output,t),n};const J=["display","animationForKey","input","output"],q=["addAnimation","animationNamed","needsDisplay","registerAnimatableProperty","removeAllAnimations","removeAnimation"],L=["layer","presentation","model","previous","animations","animationNames","animationCount"],W=new r,D=W.beginTransaction.bind(W),Z=W.commitTransaction.bind(W),K=W.currentTransaction.bind(W),_=W.flushTransaction.bind(W),B=W.disableAnimation.bind(W);function U(t,n,e,i){if(!n||!n.length)return!1;i&&n.sort((function(t,n){let e=(t.index||0)-(n.index||0);return e||(e=t.startTime-n.startTime),e||(e=t.sortIndex-n.sortIndex),e}));let r=!1;return n.forEach((function(n){r=n.composite(t,e)||r;const i=n.property;if(i&&t[i]&&t[i].px&&t[i].px.length&&t[i].px.substring&&"NaN"===t[i].px.substring(t[i].px.length-3))throw new Error("hyperact NaN composite sourceLayer:"+JSON.stringify(t)+";")})),r}t.HyperArray=c,t.HyperNumber=s,t.HyperPoint=h,t.HyperRect=class{constructor(){}zero(){return d()}add(t,n){return{origin:h.prototype.add(t.origin,n.origin),size:l.prototype.add(t.size,n.size)}}subtract(t,n){return{origin:h.prototype.subtract(t.origin,n.origin),size:l.prototype.subtract(t.size,n.size)}}interpolate(t,n,e){return{origin:h.prototype.interpolate(t.origin,n.origin,e),size:l.prototype.interpolate(t.size,n.size,e)}}toString(){return"HyperRect"}toJSON(){return this.toString()}},t.HyperScale=a,t.HyperSet=u,t.HyperSize=l,t.activate=function(t,n,e,i){if(t){if(t.registerAnimatableProperty||t.addAnimation)throw new Error("Already hyperactive");n?M(n)&&(n={display:n}):n=t,e||(e=t)}else n?M(n)&&(n={display:n}):n={},e||(e=n);const r=[],o=[];let a={};const c={},u={};let h=!1;const l={},f={};let p=null,d=null,y=null,g=null;const m=[];let b={},w=null;function A(t){W.registerFlusher(B);const e=W.currentTransaction();G();const i=Object.keys(t);w||(tt(),w={},W.registerChanger(_),g=Q()),e.disableAnimation||Object.assign(w,t),y=null,i.forEach((function(e){const i=t[e],r=I(e,n.keyInput,n),o=C(i,r,n,c);l[r]=o,f[r]=i}))}function O(t){const e=Object.keys(t),i=W.currentTransaction(),r=G();e.forEach((function(t){const e=I(t,n.keyInput,n),o=Q()[t],s=Y()[t];if(o!==s){const a=function(t,n,e,i,r,o,s,a){let c,u;if(M(r.animationForKey)&&(u=r.animationForKey.call(r,t,n,e,i)),null===u)return null;o||(o={type:s}),o&&!R(o)&&(c=Object.assign({},o)),c&&!R(u)?c=Object.assign(c,u):(u||0===u)&&(c=u);let h=P(u);return h||(h=P(o),!h||(h.duration||0===h.duration||a.duration&&(h.duration=a.duration),h.duration))?(h&&(h instanceof F||h instanceof S)&&(null!==h.property&&void 0!==h.property||(h.property=t),h instanceof F&&(null!==h.from&&void 0!==h.from||("absolute"===h.blend?h.from=i:h.from=e),null!==h.to&&void 0!==h.to||(h.to=n)),null!==h.easing&&void 0!==h.easing||(h.easing=a.easing),null!==h.duration&&void 0!==h.duration||(h.duration=a.duration),h.duration||(h.duration=0)),h):null}(t,o,s,r[t],n,u[e],c[e],i);a?$(a):tt()}}))}function v(t,n,e){if(t instanceof x)t.group.forEach((function(t){v(t,-1,e)}));else if(t instanceof E)t.chain.forEach((function(t){v(t,-1,e)}));else if(!(t instanceof F||t instanceof S))throw new Error("not an animation");var i;t.finished&&((!(i=t).finished||"forwards"!==i.fillMode&&"both"!==i.fillMode)&&function(t,n){if(n>-1){r.splice(n,1);const t=o[n];o.splice(n,1),delete a[t]}}(0,n),M(t.onend)&&e.push(t))}function T(){let t=r.length;const n=[];for(;t--;){v(r[t],t,n)}n.forEach((function(t){t.onend.call(t,!0),t.onend=null}))}function k(t){const n=r.indexOf(t);if(n>-1){r.splice(n,1);const e=o[n];o.splice(n,1),delete a[e],M(t.onend)&&t.onend.call(t,!1)}}function j(i){return(e!==t||q.indexOf(i)<0&&L.indexOf(i)<0)&&(e!==n||J.indexOf(i)<0)}function z(t,n){D(t,n)}function D(t,i,r){const o=I(t,n.keyInput,n);if(!j(t))return;let s=!1;const a=m.indexOf(o);-1===a&&(s=!0);const h=e[t];s&&m.push(o);const p=Object.getOwnPropertyDescriptor(e,t);if(null===i?(delete c[o],delete u[o],m.splice(a,1)):r||N(i)?(c[o]=i,s&&(u[o]={type:i})):(u[o]=i,i&&(c[o]=i.type)),null!=h){const t=C(h,o,n,c);l[o]=t,f[o]=h}p&&!0!==p.configurable||Object.defineProperty(e,t,{get:function(){return function(t){const e=I(t,n.keyOutput,n);return null===b?(console.log("activeBacking === null doesn't happen"),Q()[e]):b[e]}(t)},set:function(n){!function(t,n){const e={};e[n]=t,A(e)}(n,t)},enumerable:!0,configurable:!0})}function Z(){return r.length}function K(){return Object.keys(e).filter(j).reduce((function(t,n){return t[n]=e[n],t}),{})}function _(){O(w),w=null}function B(){d=null,p=null}function V(){d=null}function X(){const t=W.currentTransaction().time,e=Object.assign({},l);let i=!0;return r.length&&(i=U(e,r,t,h)),h=!1,!i&&p||(m.forEach((function(t){const i=I(t,n.keyOutput,n),r=e[t];r&&r.length&&r.substring&&r.substring(r.length-3),e[t]=function(t,n,e,i,r){if(e&&M(e.output))return e.output.call(e,n,t);let o=t;const s=i[n];return r&&M(r.output)?o=r.output.call(r,n,t):s&&M(s.output)&&(o=s.output.call(s,n,t)),o}(r,i,n,c),e[t]&&e[t].length&&e[t].substring&&e[t].substring(e[t].length-3)})),Object.freeze(e),p=e),d=null,p}function G(){if(null!==d&&null!==p)return d;const t=X(),e=K();return m.forEach((function(i){const r=t[i],o=I(i,n.keyInput,n);Object.defineProperty(e,o,{value:r,enumerable:!0,configurable:!1})})),Object.freeze(e),d=e,d}function Q(){if(null!==y)return y;const t=K();return m.forEach((function(e){const i=f[e],r=I(e,n.keyInput,n);Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!1})})),Object.freeze(t),y=t,y}function Y(){return null!==g?g:Q()}function $(t,i){const s=W.currentTransaction();G();const l=P(t);if(!(l instanceof F||l instanceof S||l instanceof x||l instanceof E))throw new Error("Not a valid animation:"+JSON.stringify(l));if(H(l,n,u,c,D),r.length||tt(),r.push(l),null!=i){const t=a[i];t&&k(t),a[i]=l}null==i||!1===i?o.push(null):o.push(i),h=!0,l.runAnimation(e,i,s)}function tt(){if(w)return;const t=M(n.display)?function(t){b=X(),n.display.call(n,t),b=f}:function(){};W.registerTarget(e,X,Z,t,V,T,!0,l)}function nt(t){const n=i?i[t]:void 0;return n&&N(n)?{type:n}:n}return Object.keys(e).filter(j).forEach((function(t){const i=e[t],r=I(t,n.keyInput,n);z(r,nt(t)||{type:new s}),f[r]=i})),i&&Object.keys(i).filter(j).forEach((function(t){z(I(t,n.keyInput,n),nt(t))})),b=Q(),b=f,t&&(t.registerAnimatableProperty=z,t.needsDisplay=function(){V(),tt()},t.addAnimation=$,t.removeAnimation=function(t){const n=a[t];n&&k(n)},t.removeAllAnimations=function(){r.length=0,o.length=0,a={},r.forEach((function(t){M(t.onend)&&t.onend.call(t,!1)}))},t.animationNamed=function(t){const e=a[t];return e?e.description.call(e,n):null},Object.defineProperty(t,"layer",{get:function(){return e},set:function(t){t&&A(t)},enumerable:!0,configurable:!1}),Object.defineProperty(t,"animationCount",{get:Z,enumerable:!0,configurable:!1}),Object.defineProperty(t,"animations",{get:function(){return r.map((t=>t.description.call(t,n)))},enumerable:!0,configurable:!1}),Object.defineProperty(t,"animationNames",{get:function(){return Object.keys(a)},enumerable:!0,configurable:!1}),Object.defineProperty(t,"presentation",{get:G,enumerable:!0,configurable:!1}),Object.defineProperty(t,"model",{get:Q,enumerable:!0,configurable:!1}),Object.defineProperty(t,"previous",{get:Y,enumerable:!0,configurable:!1})),t},t.beginTransaction=D,t.commitTransaction=Z,t.currentTransaction=K,t.disableAnimation=B,t.flushTransaction=_,t.hyperEqualPoints=m,t.hyperEqualRanges=function(t,n){return t.location===n.location&&t.length===n.length},t.hyperEqualRects=function(t,n){return m(t.origin,n.origin)&&A(t.size,n.size)},t.hyperEqualSizes=A,t.hyperIndexInRange=function(t,n){return t>n.location&&t<n.location+n.length},t.hyperIntersectionRange=function(t,n){if(t.location+t.length<=n.location||n.location+n.length<=t.location)return v();const e=Math.max(t.location,n.location);return{location:e,length:Math.min(t.location+t.length,n.location+n.length)-e}},t.hyperMakePoint=y,t.hyperMakeRange=O,t.hyperMakeRect=p,t.hyperMakeSize=b,t.hyperNotFound=f,t.hyperNullRange=v,t.hyperZeroPoint=g,t.hyperZeroRange=function(){return O(0,0)},t.hyperZeroRect=d,t.hyperZeroSize=w,t.presentationTransform=U,Object.defineProperty(t,"__esModule",{value:!0})}));
